# SaaS开发环境 - Claude Code集成版本
FROM node:20-bullseye

# 设置工作目录
WORKDIR /workspace

# 设置环境变量
ENV NODE_ENV=development
ENV TERM=xterm-256color
ENV DEBIAN_FRONTEND=noninteractive

# 安装系统依赖和开发工具
RUN apt-get update && apt-get install -y \
    git \
    curl \
    wget \
    vim \
    nano \
    htop \
    tree \
    zip \
    unzip \
    jq \
    build-essential \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

# 安装AWS CLI
RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" \
    && unzip awscliv2.zip \
    && ./aws/install \
    && rm -rf awscliv2.zip aws

# 全局安装开发工具 (分步安装避免超时)
RUN npm install -g typescript@latest @types/node vite@latest
RUN npm install -g vitest@latest eslint@latest prettier@latest  
RUN npm install -g nodemon ts-node

# 注意: Claude Code需要在容器启动后手动安装
# 因为它不在npm registry中，需要通过官方安装方式

# 配置Git (容器内临时配置)
RUN git config --global user.name "SaaS Developer" \
    && git config --global user.email "saas@example.com" \
    && git config --global init.defaultBranch main \
    && git config --global core.editor "nano"

# 创建项目目录结构
RUN mkdir -p /workspace/src/{domain,xstate,database,components,utils} \
    && mkdir -p /workspace/tests/{unit,integration,e2e} \
    && mkdir -p /workspace/docs \
    && mkdir -p /workspace/.vscode

# 暴露端口
EXPOSE 3000 3001 5173 8080

# 保持容器运行
CMD ["tail", "-f", "/dev/null"]