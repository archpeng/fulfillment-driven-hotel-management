<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  
  <!-- PWAé…ç½® -->
  <title>å±¥çº¦é©±åŠ¨ç®¡ç† - iPhoneä¸“ç”¨ç‰ˆ</title>
  <meta name="description" content="æˆ‘ä»¬ä¸ç®¡ç†å®¢æˆ¿ï¼Œæˆ‘ä»¬ç®¡ç†å®¢äºº - iOSåŸç”Ÿä½“éªŒçš„é…’åº—å±¥çº¦ç®¡ç†ç³»ç»Ÿ">
  <meta name="theme-color" content="#007AFF">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="å±¥çº¦é©±åŠ¨">
  
  <!-- iOSå›¾æ ‡ -->
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/mobile-manifest.json">
  
  <!-- iOSå¯åŠ¨ç”»é¢ -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-startup-image" 
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="/splash/iphone-xr-portrait.png">
  <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="/splash/iphone-x-portrait.png">
  <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="/splash/iphone-8-portrait.png">

  <style>
    /* é‡ç½®æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      height: 100%;
      /* iOSå®‰å…¨åŒºåŸŸé€‚é… */
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      height: 100%;
      background: #F2F2F7;
      overflow-x: hidden;
      /* ç¦ç”¨iOSæ©¡çš®ç­‹æ•ˆæœ */
      overscroll-behavior: none;
      /* ç¦ç”¨æ–‡æœ¬é€‰æ‹© */
      -webkit-user-select: none;
      user-select: none;
      /* ç¦ç”¨é•¿æŒ‰èœå• */
      -webkit-touch-callout: none;
      /* ç¦ç”¨ç‚¹å‡»é«˜äº® */
      -webkit-tap-highlight-color: transparent;
    }

    /* iOSæ ·å¼å¢å¼º */
    input, button, textarea {
      -webkit-appearance: none;
      appearance: none;
      border-radius: 0;
    }

    input:focus, textarea:focus {
      outline: none;
    }

    /* åŠ è½½åŠ¨ç”» */
    .loading-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: linear-gradient(135deg, #007AFF, #5856D6);
      color: white;
      text-align: center;
    }

    .app-logo {
      font-size: 72px;
      margin-bottom: 24px;
      animation: bounce 2s infinite;
    }

    .app-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .app-subtitle {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 40px;
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-10px);
      }
      60% {
        transform: translateY(-5px);
      }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* iOSé”®ç›˜é€‚é… */
    @supports (padding-bottom: env(keyboard-inset-height)) {
      .keyboard-aware {
        padding-bottom: env(keyboard-inset-height);
      }
    }

    /* éšè—åŠ è½½å±å¹• */
    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    /* iOS Dark Modeæ”¯æŒ */
    @media (prefers-color-scheme: dark) {
      body {
        background: #000;
        color: #fff;
      }
    }
  </style>
</head>

<body>
  <!-- åº”ç”¨åŠ è½½å±å¹• -->
  <div id="loading-screen" class="loading-screen">
    <div class="app-logo">ğŸ¨</div>
    <div class="app-title">å±¥çº¦é©±åŠ¨ç®¡ç†</div>
    <div class="app-subtitle">æˆ‘ä»¬ä¸ç®¡ç†å®¢æˆ¿ï¼Œæˆ‘ä»¬ç®¡ç†å®¢äºº</div>
    <div class="loading-spinner"></div>
  </div>

  <!-- ç§»åŠ¨åº”ç”¨å®¹å™¨ -->
  <div id="mobile-root"></div>

  <script>
    // iOSè®¾å¤‡æ£€æµ‹
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isStandalone = ('standalone' in window.navigator) && window.navigator.standalone;

    // æ€§èƒ½ç›‘æ§
    const startTime = performance.now();
    
    // PWAå®‰è£…æ£€æµ‹
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
    });

    // iOSçŠ¶æ€æ é¢œè‰²é€‚é…
    if (isIOS) {
      // åŠ¨æ€è°ƒæ•´çŠ¶æ€æ æ ·å¼
      const metaThemeColor = document.querySelector('meta[name="theme-color"]');
      const metaStatusBar = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
      
      // æ£€æµ‹ç³»ç»Ÿä¸»é¢˜
      const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (isDark) {
        metaThemeColor.content = '#1C1C1E';
        metaStatusBar.content = 'black-translucent';
      }
    }

    // ç¦ç”¨iOSåŒå‡»ç¼©æ”¾
    document.addEventListener('touchstart', function(event) {
      if (event.touches.length > 1) {
        event.preventDefault();
      }
    });

    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(event) {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // ç¦ç”¨iOSæ©¡çš®ç­‹å›å¼¹
    document.body.addEventListener('touchmove', function(e) {
      if (e.target === document.body) {
        e.preventDefault();
      }
    }, { passive: false });

    // åº”ç”¨å¯åŠ¨å®Œæˆåéšè—åŠ è½½å±å¹•
    window.addEventListener('load', function() {
      const loadTime = performance.now() - startTime;
      const minLoadTime = 1500; // æœ€å°‘æ˜¾ç¤º1.5ç§’

      setTimeout(() => {
        const loadingScreen = document.getElementById('loading-screen');
        loadingScreen.classList.add('hidden');
        
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 300);
        
        console.log(`ğŸ¨ å±¥çº¦é©±åŠ¨ç®¡ç†ç³»ç»Ÿå·²å¯åŠ¨ï¼ŒåŠ è½½æ—¶é—´: ${loadTime.toFixed(2)}ms`);
      }, Math.max(0, minLoadTime - loadTime));
    });

    // iOSæŒ¯åŠ¨åé¦ˆ
    window.iOSHaptic = {
      light: () => {
        if ('vibrate' in navigator) {
          navigator.vibrate(50);
        }
      },
      medium: () => {
        if ('vibrate' in navigator) {
          navigator.vibrate([50, 30, 50]);
        }
      },
      heavy: () => {
        if ('vibrate' in navigator) {
          navigator.vibrate([100, 50, 100]);
        }
      }
    };

    // æ€§èƒ½ç›‘æ§
    window.addEventListener('DOMContentLoaded', function() {
      // ç›‘æ§é¦–æ¬¡å†…å®¹ç»˜åˆ¶
      new PerformanceObserver((entryList) => {
        for (const entry of entryList.getEntries()) {
          console.log(`ğŸ“Š ${entry.name}: ${entry.startTime.toFixed(2)}ms`);
        }
      }).observe({ entryTypes: ['navigation', 'paint'] });
    });

    // ç¦»çº¿æ£€æµ‹
    window.addEventListener('online', function() {
      console.log('ğŸ“¶ ç½‘ç»œå·²è¿æ¥');
      document.body.classList.remove('offline');
    });

    window.addEventListener('offline', function() {
      console.log('ğŸ“µ ç½‘ç»œå·²æ–­å¼€ï¼Œå¯ç”¨ç¦»çº¿æ¨¡å¼');
      document.body.classList.add('offline');
    });
  </script>

  <!-- ç§»åŠ¨åº”ç”¨è„šæœ¬ -->
  <script type="module" src="/src/mobile-app.tsx"></script>
</body>
</html>