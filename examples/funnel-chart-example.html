<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å±¥çº¦æ¼æ–—å›¾ç»„ä»¶ç¤ºä¾‹</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f8fafc;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .header h1 {
      color: #1f2937;
      font-size: 32px;
      margin: 0 0 16px 0;
    }
    
    .header p {
      color: #6b7280;
      font-size: 18px;
      margin: 0;
    }
    
    .demo-section {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 32px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .demo-section h2 {
      color: #1f2937;
      font-size: 24px;
      margin: 0 0 20px 0;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 12px;
    }
    
    .controls {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .control-group label {
      font-size: 14px;
      font-weight: 500;
      color: #374151;
    }
    
    .control-group input, 
    .control-group select,
    .control-group button {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .control-group button {
      background: #3b82f6;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
    }
    
    .control-group button:hover {
      background: #2563eb;
    }
    
    .insights-panel {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-top: 24px;
    }
    
    .insight-card {
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
    }
    
    .insight-card h3 {
      margin: 0 0 12px 0;
      font-size: 16px;
      color: #1f2937;
    }
    
    .insight-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .insight-list li {
      padding: 8px 0;
      border-bottom: 1px solid #e5e7eb;
      color: #6b7280;
      font-size: 14px;
    }
    
    .insight-list li:last-child {
      border-bottom: none;
    }
    
    .bottleneck {
      color: #dc2626;
      font-weight: 500;
    }
    
    .healthy {
      color: #059669;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ å±¥çº¦æ¼æ–—å›¾ç»„ä»¶</h1>
      <p>å¯è§†åŒ–å±•ç¤ºå±¥çº¦è½¬åŒ–æ¼æ–—ï¼Œè¯†åˆ«è·å®¢æµç¨‹ä¸­çš„å…³é”®å¡ç‚¹</p>
    </div>

    <!-- åŸºç¡€æ¼æ–—å›¾ç¤ºä¾‹ -->
    <div class="demo-section">
      <h2>ğŸ“Š åŸºç¡€æ¼æ–—å›¾</h2>
      <div class="controls">
        <div class="control-group">
          <label>è®¤çŸ¥é˜¶æ®µäººæ•°</label>
          <input type="number" id="awareness-count" value="1000" min="0">
        </div>
        <div class="control-group">
          <label>è¯„ä¼°é˜¶æ®µäººæ•°</label>
          <input type="number" id="evaluation-count" value="400" min="0">
        </div>
        <div class="control-group">
          <label>é¢„è®¢é˜¶æ®µäººæ•°</label>
          <input type="number" id="booking-count" value="80" min="0">
        </div>
        <div class="control-group">
          <label>ä½“éªŒé˜¶æ®µäººæ•°</label>
          <input type="number" id="experiencing-count" value="75" min="0">
        </div>
        <div class="control-group">
          <label>åé¦ˆé˜¶æ®µäººæ•°</label>
          <input type="number" id="feedback-count" value="50" min="0">
        </div>
        <div class="control-group">
          <label>æ“ä½œ</label>
          <button onclick="updateFunnelData()">æ›´æ–°æ•°æ®</button>
        </div>
      </div>
      
      <div id="funnel-container-1"></div>
      
      <div class="insights-panel">
        <div class="insight-card">
          <h3>ğŸš¨ è½¬åŒ–ç“¶é¢ˆ</h3>
          <ul class="insight-list" id="bottlenecks-list">
            <li>æ•°æ®åŠ è½½ä¸­...</li>
          </ul>
        </div>
        <div class="insight-card">
          <h3>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h3>
          <ul class="insight-list" id="suggestions-list">
            <li>æ•°æ®åŠ è½½ä¸­...</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- è‡ªå®šä¹‰æ ·å¼ç¤ºä¾‹ -->
    <div class="demo-section">
      <h2>ğŸ¨ è‡ªå®šä¹‰æ ·å¼æ¼æ–—å›¾</h2>
      <div class="controls">
        <div class="control-group">
          <label>å›¾è¡¨å®½åº¦</label>
          <input type="number" id="chart-width" value="700" min="400" max="1000">
        </div>
        <div class="control-group">
          <label>å›¾è¡¨é«˜åº¦</label>
          <input type="number" id="chart-height" value="450" min="300" max="600">
        </div>
        <div class="control-group">
          <label>æ˜¾ç¤ºæ ‡ç­¾</label>
          <select id="show-labels">
            <option value="true">æ˜¯</option>
            <option value="false">å¦</option>
          </select>
        </div>
        <div class="control-group">
          <label>æ˜¾ç¤ºè½¬åŒ–ç‡</label>
          <select id="show-conversion">
            <option value="true">æ˜¯</option>
            <option value="false">å¦</option>
          </select>
        </div>
        <div class="control-group">
          <label>é«˜äº®ç“¶é¢ˆ</label>
          <select id="highlight-bottlenecks">
            <option value="true">æ˜¯</option>
            <option value="false">å¦</option>
          </select>
        </div>
        <div class="control-group">
          <label>æ“ä½œ</label>
          <button onclick="updateChartConfig()">åº”ç”¨é…ç½®</button>
        </div>
      </div>
      
      <div id="funnel-container-2"></div>
    </div>

    <!-- å®æ—¶æ•°æ®ç¤ºä¾‹ -->
    <div class="demo-section">
      <h2>âš¡ å®æ—¶æ•°æ®æ¼æ–—å›¾</h2>
      <p style="color: #6b7280; margin-bottom: 20px;">
        æ¨¡æ‹Ÿå®æ—¶æ•°æ®å˜åŒ–ï¼Œæ¯3ç§’è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡æ•°æ®
      </p>
      <div class="controls">
        <div class="control-group">
          <label>è‡ªåŠ¨æ›´æ–°</label>
          <button id="toggle-realtime" onclick="toggleRealtimeUpdate()">å¼€å§‹æ›´æ–°</button>
        </div>
        <div class="control-group">
          <label>æ›´æ–°é—´éš”</label>
          <select id="update-interval">
            <option value="1000">1ç§’</option>
            <option value="3000" selected>3ç§’</option>
            <option value="5000">5ç§’</option>
            <option value="10000">10ç§’</option>
          </select>
        </div>
      </div>
      
      <div id="funnel-container-3"></div>
    </div>
  </div>

  <script type="module">
    // è¿™é‡Œåº”è¯¥å¯¼å…¥FulfillmentFunnelChartï¼Œä¸ºäº†ç¤ºä¾‹æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬
    class DemoFulfillmentFunnelChart {
      constructor(containerId, config = {}) {
        this.container = document.getElementById(containerId);
        this.config = {
          width: 600,
          height: 400,
          showLabels: true,
          showConversionRates: true,
          highlightBottlenecks: true,
          ...config
        };
        this.data = [];
      }

      setData(rawData) {
        // ç®€åŒ–çš„æ•°æ®å¤„ç†é€»è¾‘
        const stageOrder = ['awareness', 'evaluation', 'booking', 'experiencing', 'feedback'];
        const sortedData = rawData.sort((a, b) => 
          stageOrder.indexOf(a.stage) - stageOrder.indexOf(b.stage)
        );

        this.data = sortedData.map((item, index) => {
          let conversionRate = 100;
          if (index > 0) {
            const prevCount = sortedData[index - 1].count;
            conversionRate = prevCount > 0 ? (item.count / prevCount) * 100 : 0;
          }

          const isBottleneck = conversionRate < this.getBottleneckThreshold(item.stage);

          return {
            stage: item.stage,
            stageName: this.getStageName(item.stage),
            count: item.count,
            conversionRate,
            isBottleneck
          };
        });

        this.render();
      }

      render() {
        const totalCount = this.data.reduce((sum, item) => sum + item.count, 0);
        const overallConversion = this.data.length > 0 
          ? ((this.data[this.data.length - 1].count / this.data[0].count) * 100).toFixed(1)
          : '0';

        this.container.innerHTML = `
          <div style="background: #f8fafc; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
            <!-- å¤´éƒ¨ç»Ÿè®¡ -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e2e8f0;">
              <div>
                <h3 style="font-size: 24px; font-weight: 700; color: #1f2937; margin: 0;">
                  ğŸ¯ å±¥çº¦è½¬åŒ–æ¼æ–—åˆ†æ
                </h3>
                <p style="color: #6b7280; margin: 4px 0 0 0;">
                  è¯†åˆ«è·å®¢æµç¨‹ä¸­çš„å…³é”®å¡ç‚¹å’Œä¼˜åŒ–æœºä¼š
                </p>
              </div>
              <div style="text-align: right;">
                <div style="display: flex; gap: 32px;">
                  <div>
                    <div style="font-size: 32px; font-weight: 700; color: #059669;">
                      ${totalCount.toLocaleString()}
                    </div>
                    <div style="color: #6b7280; font-size: 14px;">æ€»å®¢äººæ•°</div>
                  </div>
                  <div>
                    <div style="font-size: 32px; font-weight: 700; color: #dc2626;">
                      ${overallConversion}%
                    </div>
                    <div style="color: #6b7280; font-size: 14px;">æ•´ä½“è½¬åŒ–ç‡</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- æ¼æ–—å›¾ -->
            <div style="display: flex; justify-content: center; margin-bottom: 24px;">
              <svg width="${this.config.width}" height="${this.config.height}" style="background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                ${this.renderSVGContent()}
              </svg>
            </div>

            <!-- åˆ†æé¢æ¿ -->
            ${this.renderAnalysisPanel()}
          </div>
        `;
      }

      renderSVGContent() {
        if (this.data.length === 0) return '<text x="50%" y="50%" text-anchor="middle" fill="#6b7280">æš‚æ— æ•°æ®</text>';

        const maxCount = Math.max(...this.data.map(d => d.count));
        const funnelWidth = this.config.width * 0.6;
        const funnelHeight = this.config.height * 0.8;
        const startY = 40;
        const stageHeight = funnelHeight / this.data.length;

        let svgContent = '';

        this.data.forEach((stageData, index) => {
          const widthRatio = stageData.count / maxCount;
          const currentWidth = funnelWidth * widthRatio * 0.8 + funnelWidth * 0.2;
          
          const y = startY + index * stageHeight;
          const x = (this.config.width - currentWidth) / 2;

          const color = stageData.isBottleneck && this.config.highlightBottlenecks
            ? '#dc2626'
            : this.getStageColor(stageData.stage);

          // æ¼æ–—çŸ©å½¢
          svgContent += `
            <rect x="${x}" y="${y}" width="${currentWidth}" height="${stageHeight * 0.8}" 
                  rx="8" fill="${color}" stroke="#ffffff" stroke-width="2" opacity="0.9"/>
          `;

          if (this.config.showLabels) {
            const centerX = this.config.width / 2;
            const centerY = y + (stageHeight * 0.4);

            // é˜¶æ®µåç§°
            svgContent += `
              <text x="${centerX}" y="${centerY - 10}" text-anchor="middle" 
                    font-family="-apple-system, BlinkMacSystemFont, sans-serif" 
                    font-size="16" font-weight="600" fill="#1f2937">
                ${stageData.stageName}
              </text>
            `;

            // äººæ•°
            svgContent += `
              <text x="${centerX}" y="${centerY + 15}" text-anchor="middle" 
                    font-family="-apple-system, BlinkMacSystemFont, sans-serif" 
                    font-size="24" font-weight="700" fill="#ffffff">
                ${stageData.count.toLocaleString()}
              </text>
            `;

            // è½¬åŒ–ç‡
            if (this.config.showConversionRates && index > 0) {
              svgContent += `
                <text x="${centerX}" y="${centerY + 35}" text-anchor="middle" 
                      font-family="-apple-system, BlinkMacSystemFont, sans-serif" 
                      font-size="14" font-weight="500" fill="rgba(255,255,255,0.9)">
                  ${stageData.conversionRate.toFixed(1)}%
                </text>
              `;
            }
          }

          // ç“¶é¢ˆè­¦å‘Šå›¾æ ‡
          if (stageData.isBottleneck && this.config.highlightBottlenecks) {
            const iconX = x + currentWidth - 30;
            const iconY = y + 10;
            svgContent += `
              <circle cx="${iconX}" cy="${iconY}" r="10" fill="#fbbf24" stroke="#ffffff" stroke-width="2"/>
              <text x="${iconX}" y="${iconY + 4}" text-anchor="middle" 
                    font-family="-apple-system, BlinkMacSystemFont, sans-serif" 
                    font-size="12" font-weight="700" fill="#ffffff">!</text>
            `;
          }

          // è½¬åŒ–ç®­å¤´
          if (index < this.data.length - 1) {
            const arrowY1 = y + stageHeight * 0.8 + 10;
            const arrowY2 = startY + (index + 1) * stageHeight - 10;
            const centerX = this.config.width / 2;
            
            svgContent += `
              <path d="M ${centerX - 15} ${arrowY1} L ${centerX} ${arrowY2} L ${centerX + 15} ${arrowY1}" 
                    stroke="${this.data[index + 1].isBottleneck ? '#dc2626' : '#6b7280'}" 
                    stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            `;
          }
        });

        return svgContent;
      }

      renderAnalysisPanel() {
        const bottlenecks = this.data.filter(d => d.isBottleneck);
        
        return `
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 24px;">
            <!-- ç“¶é¢ˆåˆ†æ -->
            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <h4 style="font-size: 18px; font-weight: 600; color: #1f2937; margin: 0 0 16px 0;">
                ğŸš¨ è½¬åŒ–ç“¶é¢ˆåˆ†æ
              </h4>
              ${bottlenecks.length === 0 
                ? '<p style="color: #059669;">ğŸ‰ æ­å–œï¼å½“å‰æ²¡æœ‰å‘ç°æ˜æ˜¾çš„è½¬åŒ–ç“¶é¢ˆã€‚</p>'
                : bottlenecks.map(bottleneck => `
                    <div style="padding: 12px; background: #fef2f2; border-left: 4px solid #dc2626; border-radius: 4px; margin-bottom: 12px;">
                      <div style="font-weight: 600; color: #dc2626; margin-bottom: 4px;">
                        ${bottleneck.stageName}
                      </div>
                      <div style="color: #6b7280; font-size: 14px;">
                        è½¬åŒ–ç‡: ${bottleneck.conversionRate.toFixed(1)}%
                      </div>
                    </div>
                  `).join('')
              }
            </div>

            <!-- ä¼˜åŒ–å»ºè®® -->
            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <h4 style="font-size: 18px; font-weight: 600; color: #1f2937; margin: 0 0 16px 0;">
                ğŸ’¡ ä¼˜åŒ–å»ºè®®
              </h4>
              ${this.generateSuggestions().map(suggestion => `
                <div style="padding: 12px; background: #f0f9ff; border-left: 4px solid #0ea5e9; border-radius: 4px; margin-bottom: 12px;">
                  <div style="font-weight: 600; color: #0ea5e9; margin-bottom: 4px;">
                    ${suggestion.stage}
                  </div>
                  <div style="color: #6b7280; font-size: 14px;">
                    ${suggestion.suggestion}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      getStageName(stage) {
        const names = {
          awareness: 'è®¤çŸ¥é˜¶æ®µ',
          evaluation: 'è¯„ä¼°é˜¶æ®µ',
          booking: 'é¢„è®¢é˜¶æ®µ',
          experiencing: 'ä½“éªŒé˜¶æ®µ',
          feedback: 'åé¦ˆé˜¶æ®µ'
        };
        return names[stage] || stage;
      }

      getStageColor(stage) {
        const colors = {
          awareness: '#3B82F6',
          evaluation: '#8B5CF6',
          booking: '#10B981',
          experiencing: '#F59E0B',
          feedback: '#EF4444'
        };
        return colors[stage] || '#6B7280';
      }

      getBottleneckThreshold(stage) {
        const thresholds = {
          awareness: 100,
          evaluation: 40,
          booking: 25,
          experiencing: 85,
          feedback: 70
        };
        return thresholds[stage] || 50;
      }

      generateSuggestions() {
        const suggestions = [];
        this.data.forEach(stageData => {
          if (stageData.isBottleneck) {
            const stageSuggestions = {
              awareness: {
                stage: 'è®¤çŸ¥é˜¶æ®µ',
                suggestion: 'åŠ å¼ºå“ç‰Œæ›å…‰å’Œè¥é”€æ´»åŠ¨ï¼Œä¼˜åŒ–SEOå’Œç¤¾äº¤åª’ä½“æ¨å¹¿'
              },
              evaluation: {
                stage: 'è¯„ä¼°é˜¶æ®µ',
                suggestion: 'ä¼˜åŒ–äº§å“å±•ç¤ºé¡µé¢ï¼Œå¢åŠ å®¢æˆ·è¯„ä»·å’Œæ¡ˆä¾‹å±•ç¤º'
              },
              booking: {
                stage: 'é¢„è®¢é˜¶æ®µ',
                suggestion: 'ç®€åŒ–é¢„è®¢æµç¨‹ï¼Œæä¾›ä¼˜æƒ æ”¿ç­–ï¼Œä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ'
              },
              experiencing: {
                stage: 'ä½“éªŒé˜¶æ®µ',
                suggestion: 'åŠ å¼ºå®¢æˆ·å…³ç³»ç®¡ç†ï¼ŒåŠæ—¶è·Ÿè¿›é¢„è®¢çŠ¶æ€'
              },
              feedback: {
                stage: 'åé¦ˆé˜¶æ®µ',
                suggestion: 'å»ºç«‹å®¢æˆ·åé¦ˆæ¿€åŠ±æœºåˆ¶ï¼Œä¼˜åŒ–æœåŠ¡è´¨é‡'
              }
            };
            
            const suggestion = stageSuggestions[stageData.stage];
            if (suggestion) {
              suggestions.push(suggestion);
            }
          }
        });
        return suggestions;
      }

      updateData(newData) {
        this.setData(newData);
      }
    }

    // åˆ›å»ºå›¾è¡¨å®ä¾‹
    let funnelChart1, funnelChart2, funnelChart3;
    let realtimeInterval = null;

    // åˆå§‹åŒ–å›¾è¡¨
    function initializeCharts() {
      // åŸºç¡€æ¼æ–—å›¾
      funnelChart1 = new DemoFulfillmentFunnelChart('funnel-container-1');
      
      // è‡ªå®šä¹‰æ ·å¼æ¼æ–—å›¾
      funnelChart2 = new DemoFulfillmentFunnelChart('funnel-container-2', {
        width: 700,
        height: 450,
        showLabels: true,
        showConversionRates: true,
        highlightBottlenecks: true
      });
      
      // å®æ—¶æ•°æ®æ¼æ–—å›¾
      funnelChart3 = new DemoFulfillmentFunnelChart('funnel-container-3');

      // è®¾ç½®åˆå§‹æ•°æ®
      updateFunnelData();
    }

    // æ›´æ–°æ¼æ–—æ•°æ®
    window.updateFunnelData = function() {
      const data = [
        { stage: 'awareness', count: parseInt(document.getElementById('awareness-count').value) },
        { stage: 'evaluation', count: parseInt(document.getElementById('evaluation-count').value) },
        { stage: 'booking', count: parseInt(document.getElementById('booking-count').value) },
        { stage: 'experiencing', count: parseInt(document.getElementById('experiencing-count').value) },
        { stage: 'feedback', count: parseInt(document.getElementById('feedback-count').value) }
      ];

      funnelChart1.setData(data);
      funnelChart2.setData(data);
      funnelChart3.setData(data);

      // æ›´æ–°æ´å¯Ÿé¢æ¿
      updateInsights(funnelChart1);
    };

    // æ›´æ–°å›¾è¡¨é…ç½®
    window.updateChartConfig = function() {
      const config = {
        width: parseInt(document.getElementById('chart-width').value),
        height: parseInt(document.getElementById('chart-height').value),
        showLabels: document.getElementById('show-labels').value === 'true',
        showConversionRates: document.getElementById('show-conversion').value === 'true',
        highlightBottlenecks: document.getElementById('highlight-bottlenecks').value === 'true'
      };

      funnelChart2 = new DemoFulfillmentFunnelChart('funnel-container-2', config);
      
      // ä½¿ç”¨å½“å‰æ•°æ®é‡æ–°æ¸²æŸ“
      const data = [
        { stage: 'awareness', count: parseInt(document.getElementById('awareness-count').value) },
        { stage: 'evaluation', count: parseInt(document.getElementById('evaluation-count').value) },
        { stage: 'booking', count: parseInt(document.getElementById('booking-count').value) },
        { stage: 'experiencing', count: parseInt(document.getElementById('experiencing-count').value) },
        { stage: 'feedback', count: parseInt(document.getElementById('feedback-count').value) }
      ];
      funnelChart2.setData(data);
    };

    // åˆ‡æ¢å®æ—¶æ›´æ–°
    window.toggleRealtimeUpdate = function() {
      const button = document.getElementById('toggle-realtime');
      
      if (realtimeInterval) {
        clearInterval(realtimeInterval);
        realtimeInterval = null;
        button.textContent = 'å¼€å§‹æ›´æ–°';
        button.style.background = '#3b82f6';
      } else {
        const interval = parseInt(document.getElementById('update-interval').value);
        realtimeInterval = setInterval(() => {
          generateRandomData();
        }, interval);
        button.textContent = 'åœæ­¢æ›´æ–°';
        button.style.background = '#dc2626';
      }
    };

    // ç”Ÿæˆéšæœºæ•°æ®ï¼ˆæ¨¡æ‹Ÿå®æ—¶å˜åŒ–ï¼‰
    function generateRandomData() {
      const baseData = [1000, 400, 80, 75, 50];
      const variance = 0.2; // 20%çš„å˜åŒ–å¹…åº¦
      
      const data = baseData.map((base, index) => {
        const change = (Math.random() - 0.5) * 2 * variance;
        const newValue = Math.max(1, Math.floor(base * (1 + change)));
        
        // ç¡®ä¿æ¼æ–—é€’å‡è¶‹åŠ¿
        if (index > 0) {
          const prevValue = data[index - 1].count;
          return {
            stage: ['awareness', 'evaluation', 'booking', 'experiencing', 'feedback'][index],
            count: Math.min(newValue, prevValue)
          };
        }
        
        return {
          stage: ['awareness', 'evaluation', 'booking', 'experiencing', 'feedback'][index],
          count: newValue
        };
      });

      funnelChart3.setData(data);
    }

    // æ›´æ–°æ´å¯Ÿé¢æ¿
    function updateInsights(chart) {
      const bottlenecks = chart.data.filter(d => d.isBottleneck);
      
      // æ›´æ–°ç“¶é¢ˆåˆ—è¡¨
      const bottlenecksList = document.getElementById('bottlenecks-list');
      if (bottlenecks.length === 0) {
        bottlenecksList.innerHTML = '<li class="healthy">ğŸ‰ å½“å‰æ²¡æœ‰å‘ç°è½¬åŒ–ç“¶é¢ˆ</li>';
      } else {
        bottlenecksList.innerHTML = bottlenecks.map(b => 
          `<li class="bottleneck">${b.stageName}: ${b.conversionRate.toFixed(1)}% è½¬åŒ–ç‡</li>`
        ).join('');
      }

      // æ›´æ–°å»ºè®®åˆ—è¡¨
      const suggestionsList = document.getElementById('suggestions-list');
      const suggestions = chart.generateSuggestions();
      if (suggestions.length === 0) {
        suggestionsList.innerHTML = '<li class="healthy">âœ… æ‰€æœ‰é˜¶æ®µè½¬åŒ–ç‡æ­£å¸¸</li>';
      } else {
        suggestionsList.innerHTML = suggestions.map(s => 
          `<li>${s.stage}: ${s.suggestion}</li>`
        ).join('');
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initializeCharts);
  </script>
</body>
</html>